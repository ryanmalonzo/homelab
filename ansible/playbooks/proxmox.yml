---
- name: Configure Proxmox host
  hosts: proxmox
  become: true
  roles:
    - role: zfs
      vars:
        zfs_pool: "tank"
        zfs_pool_devices:
          - "/dev/sda"
          - "/dev/sdb"
        zfs_datasets:
          - "media"
          - "music"
          - "photos"
          - "files"
    - role: nfs
      vars:
        zfs_pool: "tank"
        zfs_datasets:
          - "media"
          - "music"
          - "photos"
          - "files"
        proxmox_subnet: "192.168.1.0/24"
        nfs_exports:
          - "/tank/media *(rw,sync,no_subtree_check,all_squash,anonuid=1000,anongid=1000)"
          - "/tank/music *(rw,sync,no_subtree_check,all_squash,anonuid=1000,anongid=1000)"
          - "/tank/photos *(rw,sync,no_subtree_check,all_squash,anonuid=1000,anongid=1000)"
          - "/tank/files *(rw,sync,no_subtree_check,all_squash,anonuid=1000,anongid=1000)"
    - role: media_dirs
      vars:
        zfs_pool: "tank"
        zfs_datasets:
          - "media"
          - "music"
          - "photos"
          - "files"
        media_directories:
          - "/tank/media"
          - "/tank/music"
          - "/tank/photos"
          - "/tank/files"
